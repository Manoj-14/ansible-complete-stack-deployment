#SPDX-License-Identifier: MIT-0
---
# tasks file for aws-vpc
- name: Create vprofile vpc
  amazon.aws.ec2_vpc_net:
    name: "{{vpc_name}}"
    cidr_block: "{{vpcCidr}}"
    region: "{{region}}"
    dns_support: yes
    dns_hostnames: yes
    tenancy: default
    state: "{{state}}"
  register: vpcout
  
# - name: create public 3 subnet
#   amazon.aws.ec2_vpc_subnet:
#     vpc_id: "{{vpcout.vpc.id}}" 
#     region: "{{region}}"
#     az: "{{zone1}}"
#     state: "{{state}}"
#     cidr: "{{PubSub1Cidr}}"
#     map_public: yes
#     resource_tags:
#       Name: vprofile-pubsub1
#   register: publicsub1_out
- name: create 3 public subnets
  amazon.aws.ec2_vpc_subnet:
    vpc_id: "{{vpcout.vpc.id}}"
    az: "{{zones[item.zone]}}"
    cidr: "{{item.cidr}}"
    state: "{{state}}"
    map_public: true
    resource_tags: {
      Name: "{{item.name}}"
    }
  loop: "{{public_subs}}"
  register: pubsub_out

- name: create 3 private subnets
  amazon.aws.ec2_vpc_subnet:
    vpc_id: "{{vpcout.vpc.id}}"
    az: "{{zones[item.zone]}}"
    cidr: "{{item.cidr}}"
    state: "{{state}}"
    resource_tags: {
      Name: "{{item.name}}"
    }
  loop: "{{private_subs}}"
  register: pubsub_out

- name: subnet results
  debug:
    msg: "{{item.subnet.tags.Name}}"
  loop: "{{pubsub_out.results}}"